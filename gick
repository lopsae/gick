#!/bin/bash

# Using the pick command prints the matching files that appear in git status.

if [[ $# = 0 ]]; then
	echo 'No parameters given' >&2
	exit 1
fi

fileList=$(git status --porcelain | cut -c 4-)

# OSX and other NIX have different option for extended regex
if [[ $(uname) == 'Darwin' ]]; then
	extendedOption="-E"
else
	extendedOption="-r"
fi

# Looks for " -> " and replaces it with a newline to split both paths
fileList=$(echo "$fileList" | sed $extendedOption "s/(.*) -> (.*)/\1|\2/" | tr "|" "\n")

# We search only in the filenames returned by status
matches=$(echo "$fileList" | pick $@ 2>/dev/null)
if [[ $? != 0 ]]; then
	echo 'No files found' >&2
	exit 2
fi

relativePath=$(git rev-parse --show-cdup)

IFS=$'\n'
for match in $matches; do
	echo "$relativePath$match"
done
unset IFS
