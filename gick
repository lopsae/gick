#!/bin/bash

read -d '' helpDoc <<"helpDoc"
NAME
    gick -- picks files from git status

SYNOPSIS
    pick [-ws] <substring>...

DESCRIPTION
    Using the pick command prints the first matching file that appears in
    git status. By default only the filename is printed.

OPTIONS
    -w  Considers only files with status in the workspace.
    
    -s  Considers only files with status in stage.
    
    -v  Prints also the status of the matched file. The format remains the
        same as with git status --short.
helpDoc


if [[ $# = 0 ]]; then
	echo 'No parameters given' >&2
	exit 1
fi

if [[ $1 = '-w' ]]; then
	shift;
	# Ignores any files without workspace status
	# TODO this can be an option in gtatus
	fileList=$(gtatus | grep --invert-match '^. ' | cut -c 4-)
else
	fileList=$(gtatus -c)
fi

# We search only in the filenames returned by status
matches=$(echo "$fileList" | pick "$@" 2>/dev/null)
if [[ $? != 0 ]]; then
	echo 'No files found' >&2
	exit 2
fi

echo "$matches"

